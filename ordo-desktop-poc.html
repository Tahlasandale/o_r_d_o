<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ordo Desktop</title>
    <link rel="stylesheet" href="css/poc-styles.css">
    <style>
        /* Styles spÃ©cifiques pour les mÃ©dias queries */
        @media (max-width: 768px) {
            .window {
                min-width: 90%;
                left: 5% !important;
                top: 5% !important;
            }

            .start-menu {
                width: 220px;
            }

            .taskbar-icon {
                width: 28px;
                height: 28px;
                font-size: 14px;
            }
        }

        .desktop-empty-state {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            opacity: 0.3;
            pointer-events: none;
            font-size: 18px;
        }

        .app-iframe {
            width: 100%;
            height: 100%;
            border: none;
            background: var(--bg-primary);
        }

        .app-container {
            display: flex;
            flex-direction: column;
            height: 100%;
        }
    </style>
</head>
<body>
    <div class="desktop">
        <div class="desktop-area" id="desktopArea">
            <div class="desktop-empty-state">
                [ORDO DESKTOP v2.0]<br>
                â””â”€ Cliquez sur DÃ©marrer pour lancer une application
            </div>
        </div>
        
        <!-- Barre des tÃ¢ches -->
        <div class="taskbar">
            <button class="start-button" id="startBtn">[DÃ‰MARRER]</button>
            <div class="taskbar-icons" id="taskbarIcons">
                <!-- Les icÃ´nes seront ajoutÃ©es dynamiquement -->
            </div>
        </div>

        <!-- Menu dÃ©marrÃ© -->
        <div class="start-menu" id="startMenu">
            <div class="start-menu-header">[MENU ORDO]</div>
            <div class="start-menu-items" id="startMenuItems">
                <!-- Les Ã©lÃ©ments du menu seront ajoutÃ©s dynamiquement -->
            </div>
        </div>

        <!-- Les fenÃªtres seront ajoutÃ©es dynamiquement ici -->
    </div>

        <script>
        // Configuration des applications
        const APPS = {
            todo: {
                id: 'todo',
                title: 'Gestionnaire de tÃ¢ches',
                icon: 'ðŸ“',
                width: 500,
                height: 400,
                defaultX: 50,
                defaultY: 50
            },
            timer: {
                id: 'timer',
                title: 'Timer Pomodoro',
                icon: 'â±ï¸',
                width: 450,
                height: 300,
                defaultX: 600,
                defaultY: 50
            },
            editor: {
                id: 'editor',
                title: 'Ã‰diteur de texte',
                icon: 'ðŸ“„',
                width: 600,
                height: 500,
                defaultX: 100,
                defaultY: 100
            }
        };

        // Ã‰lÃ©ments du DOM
        const desktopArea = document.getElementById('desktopArea');
        const startBtn = document.getElementById('startBtn');
        const startMenu = document.getElementById('startMenu');
        const startMenuItems = document.getElementById('startMenuItems');
        const taskbarIcons = document.getElementById('taskbarIcons');
        const openWindows = new Map();
        let zIndex = 10;

        // Initialisation du menu et de la barre des tÃ¢ches
        function initUI() {
            // CrÃ©ation des Ã©lÃ©ments du menu dÃ©marrÃ©
            Object.values(APPS).forEach(app => {
                // Ã‰lÃ©ment du menu dÃ©marrÃ©
                const menuItem = document.createElement('div');
                menuItem.className = 'start-menu-item';
                menuItem.dataset.app = app.id;
                menuItem.innerHTML = `
                    <span class="start-menu-item-icon">${app.icon}</span>
                    <span>${app.title}</span>
                `;
                menuItem.addEventListener('click', () => openApp(app.id));
                startMenuItems.appendChild(menuItem);

                // IcÃ´ne de la barre des tÃ¢ches
                const taskbarIcon = document.createElement('div');
                taskbarIcon.className = 'taskbar-icon';
                taskbarIcon.dataset.app = app.id;
                taskbarIcon.title = app.title;
                taskbarIcon.textContent = app.icon;
                taskbarIcon.addEventListener('click', () => toggleApp(app.id));
                taskbarIcons.appendChild(taskbarIcon);
            });
        }

        // Gestion du menu dÃ©marrÃ©
        function toggleStartMenu() {
            startMenu.classList.toggle('active');
            
            // Si on ouvre le menu, on met le focus sur le premier Ã©lÃ©ment
            if (startMenu.classList.contains('active')) {
                const firstMenuItem = startMenu.querySelector('.start-menu-item');
                if (firstMenuItem) firstMenuItem.focus();
            }
        }

        // Clic sur le bouton DÃ©marrer
        startBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            toggleStartMenu();
        });

        // Gestion de la touche Alt
        let altPressed = false;
        
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Alt' && !altPressed) {
                e.preventDefault();
                altPressed = true;
                toggleStartMenu();
            }
        });

        document.addEventListener('keyup', (e) => {
            if (e.key === 'Alt') {
                altPressed = false;
            }
        });

        // EmpÃªcher le comportement par dÃ©faut de Alt pour Ã©viter le menu du navigateur
        window.addEventListener('keydown', function(e) {
            if (e.key === 'Alt') {
                e.preventDefault();
            }
        }, true);

        // Fermer le menu quand on clique ailleurs
        document.addEventListener('click', (e) => {
            if (startMenu && !startMenu.contains(e.target) && e.target !== startBtn) {
                startMenu.classList.remove('active');
            }
        });

        startMenu.addEventListener('click', (e) => {
            e.stopPropagation();
        });

        // Gestion des fenÃªtres
        function createWindow(appId) {
            if (openWindows.has(appId)) {
                return openWindows.get(appId);
            }

            const app = APPS[appId];
            if (!app) return null;

            const windowId = `${appId}Window`;
            
            // CrÃ©ation de la fenÃªtre
            const window = document.createElement('div');
            window.className = 'window active';
            window.id = windowId;
            window.style.left = `${app.defaultX}px`;
            window.style.top = `${app.defaultY}px`;
            window.style.width = `${app.width}px`;
            window.style.height = `${app.height}px`;
            window.style.zIndex = zIndex++;

            // En-tÃªte de la fenÃªtre
            const windowHeader = document.createElement('div');
            windowHeader.className = 'window-header';
            windowHeader.innerHTML = `
                <span class="window-title">[${app.title.toUpperCase()}]</span>
                <div class="window-controls">
                    <div class="window-control close" data-window="${appId}" title="Fermer"></div>
                </div>
            `;

            // Contenu de la fenÃªtre (iframe)
            const windowContent = document.createElement('div');
            windowContent.className = 'window-content app-container';
            
            const iframe = document.createElement('iframe');
            iframe.className = 'app-iframe';
            iframe.sandbox = 'allow-same-origin allow-scripts allow-forms';
            iframe.src = `apps/${appId}/index.html`;
            iframe.dataset.app = appId;

            windowContent.appendChild(iframe);
            window.appendChild(windowHeader);
            window.appendChild(windowContent);
            desktopArea.appendChild(window);

            // Gestion du dÃ©placement des fenÃªtres
            makeDraggable(window, windowHeader);

            // Gestion du bouton de fermeture
            const closeBtn = windowHeader.querySelector('.close');
            closeBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                closeApp(appId);
            });

            // Mise au premier plan au clic
            window.addEventListener('mousedown', () => {
                bringToFront(window);
            });

            // Mise Ã  jour de l'Ã©tat
            openWindows.set(appId, window);
            updateTaskbarIcon(appId, true);

            return window;
        }

        function makeDraggable(element, handle) {
            let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
            
            handle.onmousedown = dragMouseDown;
            
            function dragMouseDown(e) {
                e = e || window.event;
                e.preventDefault();
                // Obtenir la position de la souris au dÃ©marrage
                pos3 = e.clientX;
                pos4 = e.clientY;
                document.onmouseup = closeDragElement;
                // Appeler une fonction chaque fois que la souris bouge
                document.onmousemove = elementDrag;
                
                // Mettre la fenÃªtre au premier plan
                bringToFront(element);
            }
            
            function elementDrag(e) {
                e = e || window.event;
                e.preventDefault();
                // Calculer la nouvelle position du curseur
                pos1 = pos3 - e.clientX;
                pos2 = pos4 - e.clientY;
                pos3 = e.clientX;
                pos4 = e.clientY;
                // DÃ©finir la nouvelle position de l'Ã©lÃ©ment
                element.style.top = (element.offsetTop - pos2) + "px";
                element.style.left = (element.offsetLeft - pos1) + "px";
            }
            
            function closeDragElement() {
                // ArrÃªter le dÃ©placement lorsque le bouton de la souris est relÃ¢chÃ©
                document.onmouseup = null;
                document.onmousemove = null;
            }
        }

        function bringToFront(windowElement) {
            windowElement.style.zIndex = zIndex++;
        }

        function openApp(appId) {
            const window = createWindow(appId);
            if (window) {
                window.classList.add('active');
                bringToFront(window);
                
                // Donner le focus Ã  l'iframe
                const iframe = window.querySelector('iframe');
                if (iframe && iframe.contentWindow) {
                    iframe.contentWindow.postMessage('focus', '*');
                }
            }
            
            startMenu.classList.remove('active');
            startBtn.classList.remove('active');
        }

        function closeApp(appId) {
            const window = openWindows.get(appId);
            if (window) {
                window.classList.remove('active');
                updateTaskbarIcon(appId, false);
            }
        }

        function toggleApp(appId) {
            const window = openWindows.get(appId);
            if (window && window.classList.contains('active')) {
                closeApp(appId);
            } else {
                openApp(appId);
            }
        }

        function updateTaskbarIcon(appId, isActive) {
            const icon = document.querySelector(`.taskbar-icon[data-app="${appId}"]`);
            if (icon) {
                if (isActive) {
                    icon.classList.add('active');
                } else {
                    icon.classList.remove('active');
                }
            }
        }

        // Initialisation de l'interface
        initUI();
        document.querySelectorAll('.start-menu-item').forEach(item => {
            item.addEventListener('click', () => {
                openApp(item.dataset.app);
            });
        });

        // Fermeture des fenÃªtres
        document.querySelectorAll('.window-control.close').forEach(btn => {
            btn.addEventListener('click', () => {
                const windowId = btn.dataset.window + 'Window';
                document.getElementById(windowId).classList.remove('active');
            });
        });

        // DÃ©placement des fenÃªtres
        document.querySelectorAll('.window-header').forEach(header => {
            let isDragging = false;
            let currentX, currentY, initialX, initialY;

            header.addEventListener('mousedown', (e) => {
                if (e.target.classList.contains('window-control')) return;
                isDragging = true;
                const window = header.parentElement;
                initialX = e.clientX - window.offsetLeft;
                initialY = e.clientY - window.offsetTop;
            });

            document.addEventListener('mousemove', (e) => {
                if (!isDragging) return;
                e.preventDefault();
                const window = header.parentElement;
                currentX = e.clientX - initialX;
                currentY = e.clientY - initialY;
                window.style.left = currentX + 'px';
                window.style.top = currentY + 'px';
            });

            document.addEventListener('mouseup', () => {
                isDragging = false;
            });
        });

        // APP TO-DO
        const todoInput = document.getElementById('todoInput');
        const todoAddBtn = document.getElementById('todoAddBtn');
        const todoList = document.getElementById('todoList');

        let todos = JSON.parse(localStorage.getItem('ordoTodos')) || [];

        function saveTodos() {
            localStorage.setItem('ordoTodos', JSON.stringify(todos));
        }

        function renderTodos() {
            todoList.innerHTML = '';
            todos.forEach((todo, index) => {
                const li = document.createElement('li');
                li.className = 'todo-item' + (todo.completed ? ' completed' : '');
                li.innerHTML = `
                    <input type="checkbox" class="todo-checkbox" ${todo.completed ? 'checked' : ''} data-index="${index}">
                    <span class="todo-text">${todo.text}</span>
                    <button class="todo-delete" data-index="${index}">[X]</button>
                `;
                todoList.appendChild(li);
            });
        }

        function addTodo() {
            const text = todoInput.value.trim();
            if (text) {
                todos.push({ text, completed: false });
                saveTodos();
                renderTodos();
                todoInput.value = '';
            }
        }

        todoAddBtn.addEventListener('click', addTodo);
        todoInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') addTodo();
        });

        todoList.addEventListener('click', (e) => {
            if (e.target.classList.contains('todo-checkbox')) {
                const index = e.target.dataset.index;
                todos[index].completed = e.target.checked;
                saveTodos();
                renderTodos();
            }
            if (e.target.classList.contains('todo-delete')) {
                const index = e.target.dataset.index;
                todos.splice(index, 1);
                saveTodos();
                renderTodos();
            }
        });

        renderTodos();

        // APP TIMER
        const timerDisplay = document.getElementById('timerDisplay');
        const timerStart = document.getElementById('timerStart');
        const timerReset = document.getElementById('timerReset');
        const timerContent = document.getElementById('timerContent');

        let timerInterval = null;
        let timeLeft = 25 * 60;

        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        function updateTimerDisplay() {
            timerDisplay.textContent = formatTime(timeLeft);
        }

        function startTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
                timerStart.textContent = '[START]';
                timerContent.classList.remove('timer-complete');
            } else {
                timerStart.textContent = '[PAUSE]';
                timerInterval = setInterval(() => {
                    timeLeft--;
                    updateTimerDisplay();
                    if (timeLeft <= 0) {
                        clearInterval(timerInterval);
                        timerInterval = null;
                        timerStart.textContent = '[START]';
                        timerContent.classList.add('timer-complete');
                        setTimeout(() => {
                            timerContent.classList.remove('timer-complete');
                        }, 3000);
                    }
                }, 1000);
            }
        }

        function resetTimer() {
            clearInterval(timerInterval);
            timerInterval = null;
            timeLeft = 25 * 60;
            updateTimerDisplay();
            timerStart.textContent = '[START]';
            timerContent.classList.remove('timer-complete');
        }

        timerStart.addEventListener('click', startTimer);
        timerReset.addEventListener('click', resetTimer);

        // APP Ã‰DITEUR
        const editorText = document.getElementById('editorText');
        const editorStatus = document.getElementById('editorStatus');

        editorText.value = localStorage.getItem('ordoEditorText') || '';

        let saveTimeout;
        editorText.addEventListener('input', () => {
            clearTimeout(saveTimeout);
            editorStatus.textContent = 'â””â”€ Sauvegarde en cours...';
            saveTimeout = setTimeout(() => {
                localStorage.setItem('ordoEditorText', editorText.value);
                editorStatus.textContent = 'â””â”€ SauvegardÃ© [' + new Date().toLocaleTimeString() + ']';
            }, 1000);
        });
    </script>
</body>
</html>